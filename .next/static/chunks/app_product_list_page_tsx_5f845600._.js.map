{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Administrator/Downloads/crm%20%282%29/crm/app/product/list/page.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport Link from 'next/link';\r\nimport { useSearchParams, usePathname } from 'next/navigation';\r\nimport DataTable from 'react-data-table-component';\r\nimport { saveAs } from 'file-saver';\r\nimport * as XLSX from 'xlsx';\r\nimport jsPDF from 'jspdf';\r\nimport autoTable from 'jspdf-autotable';\r\nimport { FaEye, FaEdit, FaTrash, FaChevronRight } from 'react-icons/fa';\r\nimport { FaFileExcel, FaFilePdf, FaFileCsv } from 'react-icons/fa';\r\n\r\ntype Product = {\r\n  product_id: number;\r\n  product_name: string;\r\n  product_code: string;\r\n  product_short_name: string | null;\r\n  product_type: string;\r\n  product_model_number: string | null;\r\n  product_uom: string | null;\r\n};\r\n\r\ninterface RawProduct {\r\n  product_id: number;\r\n  product_name: string;\r\n  product_code: string;\r\n  product_short_name: string | null;\r\n  product_type: string;\r\n  product_model_number: string | null;\r\n  product_uom: string | null;\r\n}\r\n\r\nconst Breadcrumb = () => {\r\n  const pathname = usePathname();\r\n\r\n  const breadcrumbItems = [{ label: 'All', href: '/product/' }];\r\n  if (pathname === '/product/add' || pathname === '/product/add/') {\r\n    breadcrumbItems.push({ label: 'Form', href: '/product/add/' });\r\n  }\r\n\r\n  return (\r\n    <nav className=\"flex items-center space-x-2 text-sm text-gray-600\">\r\n      {breadcrumbItems.map((item, index) => (\r\n        <div key={index} className=\"flex items-center\">\r\n          {index > 0 && <FaChevronRight className=\"mx-2 text-gray-400\" size={12} />}\r\n          <Link href={item.href} className=\"text-blue-600 hover:text-blue-800 transition-colors\">\r\n            {item.label}\r\n          </Link>\r\n        </div>\r\n      ))}\r\n    </nav>\r\n  );\r\n};\r\n\r\nexport default function ProductListPage() {\r\n  const [allProducts, setAllProducts] = useState<Product[]>([]);\r\n  const [products, setProducts] = useState<Product[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState('');\r\n  const searchParams = useSearchParams();\r\n  const success = searchParams.get('success');\r\n\r\n  useEffect(() => {\r\n    async function fetchProducts() {\r\n      try {\r\n        const res = await fetch('/api/product/list');\r\n        if (!res.ok) throw new Error('Failed to fetch products');\r\n        const data = await res.json();\r\n\r\n        const mappedProducts: Product[] = data.products.map((p: RawProduct) => ({\r\n          product_id: p.product_id,\r\n          product_name: p.product_name,\r\n          product_code: p.product_code,\r\n          product_short_name: p.product_short_name,\r\n          product_type: p.product_type,\r\n          product_model_number: p.product_model_number,\r\n          product_uom: p.product_uom,\r\n        }));\r\n\r\n        setAllProducts(mappedProducts);\r\n        setProducts(mappedProducts);\r\n      } catch (err) {\r\n        setError((err as Error).message);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    }\r\n\r\n    fetchProducts();\r\n  }, []);\r\n\r\n  const handleDelete = async (row: Product) => {\r\n    const confirmDelete = window.confirm(`Are you sure you want to delete this product?`);\r\n    if (!confirmDelete) return;\r\n\r\n    try {\r\n      const res = await fetch(`/api/product/${row.product_id}`, {\r\n        method: 'DELETE',\r\n      });\r\n\r\n      if (!res.ok) {\r\n        const data = await res.json();\r\n        throw new Error(data.error || 'Failed to delete product');\r\n      }\r\n\r\n      const updatedList = products.filter((p) => p.product_id !== row.product_id);\r\n      setProducts(updatedList);\r\n      setAllProducts(updatedList);\r\n    } catch (err) {\r\n      alert((err as Error).message);\r\n    }\r\n  };\r\n\r\n  const columns = [\r\n    { name: 'ID', selector: (row: Product) => row.product_id, sortable: true, width: '70px' },\r\n    { name: 'Product Name', selector: (row: Product) => row.product_name, sortable: true, wrap: true },\r\n    { name: 'Code', selector: (row: Product) => row.product_code, wrap: true },\r\n    { name: 'Short Name', selector: (row: Product) => row.product_short_name || '', wrap: true },\r\n    {\r\n      name: 'Type',\r\n      selector: (row: Product) => row.product_type.replace('_', ' '),\r\n      wrap: true,\r\n    },\r\n    { name: 'Model No.', selector: (row: Product) => row.product_model_number || '', wrap: true },\r\n    { name: 'UOM', selector: (row: Product) => row.product_uom || '', wrap: true },\r\n\r\n    {\r\n      name: 'Actions',\r\n      cell: (row: Product) => (\r\n        <div className=\"flex space-x-3\">\r\n          <Link href={`/product/view/${row.product_id}`}>\r\n            <FaEye className=\"text-blue-600 hover:text-blue-800 cursor-pointer\" title=\"View\" />\r\n          </Link>\r\n          <Link href={`/product/edit/${row.product_id}`}>\r\n            <FaEdit className=\"text-green-600 hover:text-green-800 cursor-pointer\" title=\"Edit\" />\r\n          </Link>\r\n          <button onClick={() => handleDelete(row)}>\r\n            <FaTrash className=\"text-red-600 hover:text-red-800 cursor-pointer\" title=\"Delete\" />\r\n          </button>\r\n        </div>\r\n      ),\r\n      width: '120px',\r\n    },\r\n  ];\r\n\r\n  const exportToExcel = () => {\r\n    const worksheet = XLSX.utils.json_to_sheet(products);\r\n    const workbook = XLSX.utils.book_new();\r\n    XLSX.utils.book_append_sheet(workbook, worksheet, 'Products');\r\n    const excelBuffer = XLSX.write(workbook, { type: 'array', bookType: 'xlsx' });\r\n    const data = new Blob([excelBuffer], { type: 'application/octet-stream' });\r\n    saveAs(data, 'products.xlsx');\r\n  };\r\n\r\n  const exportToPDF = () => {\r\n    const doc = new jsPDF();\r\n    const tableData = products.map((prod) => [\r\n      prod.product_id,\r\n      prod.product_name,\r\n      prod.product_code,\r\n      prod.product_short_name || '',\r\n      prod.product_type.replace('_', ' '),\r\n      prod.product_model_number || '',\r\n      prod.product_uom || '',\r\n    ]);\r\n\r\n    autoTable(doc, {\r\n      head: [['ID', 'Name', 'Code', 'Short Name', 'Type', 'Model No.', 'UOM']],\r\n      body: tableData,\r\n      styles: { fontSize: 8 },\r\n      headStyles: { fillColor: [22, 160, 133] },\r\n    });\r\n\r\n    doc.save('products.pdf');\r\n  };\r\n\r\n  const exportToCSV = () => {\r\n    const headers = ['ID', 'Name', 'Code', 'Short Name', 'Type', 'Model No.', 'UOM'];\r\n    const rows = products.map((p) =>\r\n      [\r\n        p.product_id,\r\n        `\"${p.product_name}\"`,\r\n        `\"${p.product_code}\"`,\r\n        `\"${p.product_short_name || ''}\"`,\r\n        `\"${p.product_type}\"`,\r\n        `\"${p.product_model_number || ''}\"`,\r\n        `\"${p.product_uom || ''}\"`,\r\n      ].join(',')\r\n    );\r\n    const csvContent = [headers.join(','), ...rows].join('\\n');\r\n    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });\r\n    saveAs(blob, 'products.csv');\r\n  };\r\n\r\n  const handleSearch = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n    const value = event.target.value.toLowerCase();\r\n    if (!value) return setProducts(allProducts);\r\n\r\n    const filtered = allProducts.filter((product) =>\r\n      Object.values(product).some((field) =>\r\n        String(field).toLowerCase().includes(value)\r\n      )\r\n    );\r\n    setProducts(filtered);\r\n  };\r\n\r\n  return (\r\n    <div className=\"max-w-6xl mx-auto px-6 py-10\">\r\n      <div className=\"flex justify-between items-start mb-6\">\r\n        <Breadcrumb />\r\n      </div>\r\n\r\n      <div className=\"flex justify-between items-center mb-4 flex-wrap gap-2\">\r\n        <h1 className=\"text-3xl font-bold\">Product List</h1>\r\n        <div className=\"space-x-2 flex flex-wrap items-center\">\r\n          <Link\r\n            href=\"/product/add\"\r\n            className=\"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition whitespace-nowrap\"\r\n          >\r\n            + Add\r\n          </Link>\r\n          <button\r\n            onClick={exportToExcel}\r\n            className=\"bg-green-600 text-white px-3 py-1 rounded hover:bg-green-700 transition whitespace-nowrap flex items-center gap-2\"\r\n          >\r\n            <FaFileExcel size={18} />\r\n            Excel\r\n          </button>\r\n\r\n          <button\r\n            onClick={exportToPDF}\r\n            className=\"bg-red-600 text-white px-3 py-1 rounded hover:bg-red-700 transition whitespace-nowrap flex items-center gap-2\"\r\n          >\r\n            <FaFilePdf size={18} />\r\n            PDF\r\n          </button>\r\n\r\n          <button\r\n            onClick={exportToCSV}\r\n            className=\"bg-yellow-600 text-white px-3 py-1 rounded hover:bg-yellow-700 transition whitespace-nowrap flex items-center gap-2\"\r\n          >\r\n            <FaFileCsv size={18} />\r\n            CSV\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {success === 'added' && <p className=\"text-green-600 mb-4\">Product added successfully!</p>}\r\n      {loading && <p>Loading...</p>}\r\n      {error && <p className=\"text-red-500\">{error}</p>}\r\n\r\n      {!loading && !error && (\r\n        <>\r\n          <input\r\n            type=\"text\"\r\n            placeholder=\"Search products...\"\r\n            onChange={handleSearch}\r\n            className=\"border p-2 rounded mb-4 w-full max-w-sm\"\r\n          />\r\n\r\n          <DataTable\r\n            columns={columns}\r\n            data={products}\r\n            pagination\r\n            highlightOnHover\r\n            dense\r\n            fixedHeader\r\n            noHeader\r\n            persistTableHead\r\n          />\r\n        </>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}